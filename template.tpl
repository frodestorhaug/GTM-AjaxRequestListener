___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "AjaxRequestListener",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Listens for xhr requests and push info to datalayer ajaxInfo and sends event ajaxSuccess",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SIMPLE_TABLE",
    "name": "excludeUrls",
    "displayName": "Excluded urls",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Url",
        "name": "url",
        "type": "TEXT"
      }
    ],
    "help": "exclude urls that startswith urls in list"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Debugmode",
    "simpleValueType": true,
    "defaultValue": false
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "excludeUrlWithStrings",
    "displayName": "Exclude URLs containing string",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "ExcludedString",
        "name": "excludedString",
        "type": "TEXT"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const setInWindow = require('setInWindow');
const queryPermission = require('queryPermission');

const log = data.debug ? logToConsole : (() => {});
const urls = data.excludeUrls;
const excludeStrings = data.excludeUrlWithStrings;
const getSettings = () => {
  if(!urls) {
    log("no excludes");
  }else {
    log(urls);
    const ajrS = copyFromWindow('ajrS');
    if (!ajrS) {
      setInWindow('ajrS', urls);
    }    
  }
  if(!excludeStrings) {
    log("no excludeStrings");
  }else {
    log(excludeStrings);
    const exStr = copyFromWindow('exStr');
    if (!exStr) {
      setInWindow('exStr', excludeStrings);
    }
  }
  return false;
};

getSettings();

const url = 'https://effekt.blob.core.windows.net/gtmscripts/ajax-script-min.js';
if (queryPermission('inject_script', url)) {
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);
}
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://effekt.blob.core.windows.net/gtmscripts/ajax-script-min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ajrS"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "exStr"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 7/13/2021, 8:58:38 AM


